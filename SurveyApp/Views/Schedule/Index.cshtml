@using System.Data;
@{
    ViewBag.Title = "Schedule Manager";
    Layout = "~/Views/Shared/_Layout.cshtml";
    var dsSchedules = SurveyApp.DataHelper.ScheduleGetAll();
}

@functions{
    public string getFrequency(object freq, object daysToRepeat) {
        if (freq == null)
        {
            return "";
        }

        int frequency = Convert.ToInt32(freq);
        if (frequency == 1)
        {
            return "Once";
        }
        else{
            return "Repeating after " + Convert.ToInt32(daysToRepeat) + " day(s)";
        }
    }

    public string getActivationType(object act, object day, object month, object weekday)
    {
        if (act == null)
        {
            return "";
        }

        int activation = Convert.ToInt32(act);
        if (activation == 1)
        {
            return "Enrolment";
        }
        else
        {
            if (weekday != null && weekday != DBNull.Value && Convert.ToInt32(weekday) > 0)
            {
                return "Activates every " + SurveyApp.Models.ScheduleWeekday.getWeekdayName(Convert.ToInt32(weekday));
            }
            else
            {
                string months = "";
                foreach (string monthId in month.ToString().Split(','))
                {
                    months += " " + SurveyApp.Models.ScheduleMonth.getMonthNameShort(Convert.ToInt32(monthId)) + ",";
                }
                return "Activates every " + Convert.ToInt32(day) + " of" + months.TrimEnd(',');
            }
        }
    }
}

<script type="text/javascript">
    $(function () {
        $("#tblSchedules").DataTable({ dom: 'Bfrtip', buttons: [{ extend: 'excel', text: "Export to Excel" }] });
    });
</script>
<div>
    <h2 class="col-sm-11" style="margin: 0px;padding: 0px;">Schedule Management</h2>
    @Html.ActionLink("Add Schedule", "ScheduleAddEdit", "Schedule", new object { }, new { @class = "btn btn-default", style = "float:right;" })
</div>
<div style="clear:both;"></div>
<br />
<style>
    .table-hover tbody tr {
        cursor: pointer;
    }
</style>
<table class="table table-striped table-hover" id="tblSchedules">
    <thead>
        <tr>
            <th>Title</th>
            <th>Frequency</th>
            <th>Active On</th>
            <th>Available Until</th>
            <th>Reminder Frequency</th>
            <th>Last Reminder</th>
            <th style="width: 50px;">Action</th>
        </tr>
    </thead>
    <tbody>
        @if (dsSchedules != null && dsSchedules.Tables.Count > 0 && dsSchedules.Tables[0] != null && dsSchedules.Tables[0].Rows.Count > 0)
        {
            foreach (DataRow dr in dsSchedules.Tables[0].Rows)
            {
                <tr onclick="location.href = '@Url.Action("ScheduleAddEdit", "Schedule", new { id = dr["Id"] })';">
                    <td>@dr["Title"]</td>
                    <td>@getFrequency(dr["Frequency"], dr["DaysToRepeat"])</td>
                    <td>@getActivationType(dr["ActiveOn"], dr["Day"], dr["Month"], dr["Weekday"])</td>
                    <td>@dr["AvailableUntil"] day(s)</td>
                    <td>Every @dr["ReminderFrequency"] day(s)</td>
                    <td>-@dr["LastReminder"] day(s) from last day</td>
                    <td style="text-align: center;vertical-align:middle;"><a href="javascript:void(0);" class="redCross" onclick="event.stopPropagation();deleteListItem(this, @dr["Id"], 'schedule', '@dr["Title"]');"></a></td>
                </tr>
            }
        }

    </tbody>
</table>